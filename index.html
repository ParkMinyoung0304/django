<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/root/myDjango/static/jquery-3.6.0.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <center>
       新用户注册<hr>
       <table>
           <tr><td align="right">用户ID：</td>
               <td><input type="text" id="uid" maxlength="10">
                   <span id="ruid"></span></td></tr>
           <tr><td align="right">密码：</td>
               <td><input type="password" id="pwd1" maxlength="8"></td></tr>
           <tr><td align="right">再次输入密码：</td>
               <td><input type="password" id="pwd2" maxlength="8"></td></tr>
            <tr><td align="right">Email：</td>
               <td><input type="email" id="email" maxlength="20"></td></tr>
           <tr><td align="right">验证码</td>
               <td><img src="/view_manage/getpng" id="icode" />单击刷新<br />
                   <input type="text" id="code" maxlength="10"></td></tr>
           <tr><td colspan="2" align="center">
               <td><input type="button" value="提交" id="submit"></td></tr>
       </table>
       <hr><span id="result"></span>
    </center>
    <script>
         var codeok = false
         var idok = false
         $(document).ready(function(){
             $('input').keyup(function (){
                $('#result').html('')});
             $('#uid').keyup(function (){
                 var uid = $("#uid").val();
                 $.get("/checkuid/", {'uid':uid}, function(r){
                     if (r == 'ID可用') {idok =true } else { idok =false}
                     $('#ruid').html(r)})
             });
             $('#icode').click(function(){
                 var a = (new Date()).toTimeString()
                 $('#icode').attr('src','/getpng/?t='+a)
                 codeok = false});
             $('#code').blur(function(){
                 var code = $("#code").val();
                 $.get("/checkcode/", {},function(r){
                     if (r.toLowerCase() == code.toLowerCase()) {codeok = true}
                 else{codeok = false}
                 })   
         });
         $('#submit').click(function () {
             if(!idok){
                 $('#result').html('<span style="color:red">你输入的用户ID已被占用！</span>')
                    return 1 }
        var pwd1 = $("#pwd1").val();
        var pwd2 = $("#pwd2").val();
        pwdok = false
        if(pwd1 != pwd2){
            $('#result').html('<span style="color:red">两次输入的密码不一致！<span>')
                return1}
        var reg = /^\w+@[a-zA-Z0-9]{2,10}(?:\.[a-z]{2,4}){1,3}$/;
        if (!reg.test($("#email").val())){
            $('#result').html('<span style="color:red">你输入的Email地址无效！<span>')
                return1}
        if(!codeok){
            $('#result').html('<span style="color:red">验证码输入错误！<span>')
                return1}
        var uid = $("#uid").val();
        var pwd = $("#pwd").val();
        var email = $("#email").val();
        var data = { 'uid':uid,'pwd':pwd,'email':email}
        $.get("/addnew/",{'uid':uid,'pwd':pwd,'email':email},
              function(r) { $('#result').html(r)})});
        });
    </script>
    <script src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>

    <script>
        new VConsole();
    </script>
</body>
</html>
